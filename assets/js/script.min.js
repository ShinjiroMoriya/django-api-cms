$.ajaxSetup({beforeSend:function(a,b){function c(a){var b=null;if(document.cookie&&document.cookie!=''){var c=document.cookie.split(';');for(var d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==(a+'=')){b=decodeURIComponent(e.substring(a.length+1));break;}}}return b;}if(!(/^http:.*/.test(b.url)||/^https:.*/.test(b.url)))a.setRequestHeader("X-CSRFToken",c('csrftoken'));}});$('form').on('submit',function(){$(document).find('#loading').show();});$('body').append('<div id="loading" class="loading"></div>');$('.status_select').on('change',function(){var a=$(this).attr('data-post_id');var b=$(this).val();var c='/post/status/'+a;$.ajax({type:'POST',url:c,cache:false,data:{'status':b},context:this}).done(function(a){$('.header_status_text').text('更新しました');$('.header_status').addClass('_show _success');}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(a){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _success _error');},1000);});});if($('#tinymce_textarea').length!=0){function a(a,b){$('#image_upload').off('submit');$('#image_upload').on('submit',function(c){c.stopPropagation();c.preventDefault();var d=new FormData();$.each(a.target.files,function(a,b){d.append('image_file',b);});$('#loading').show();$.ajax({type:'POST',url:'/image/add',cache:false,data:d,processData:false,contentType:false}).done(function(a){b(a.image_url);}).fail(function(a){$('.header_status_text').text(a.responseJSON.message);$('.header_status').addClass('_show _error');}).always(function(a){$('input[name="image_file"]').val('');$('#loading').hide();setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _success _error');},5000);});});$('#image_upload').trigger('submit');};function b(a,b){$('#pdf_form').off('submit');$('#pdf_form').on('submit',function(c){c.stopPropagation();c.preventDefault();var d=new FormData();$.each(a.target.files,function(a,b){d.append('pdf_file',b);});$('#loading').show();$.ajax({type:'POST',url:'/pdf/add',cache:false,data:d,processData:false,contentType:false}).done(function(a){b(a.pdf_url,{text:a.title});}).fail(function(a){$('.header_status_text').text(a.responseJSON.message);$('.header_status').addClass('_show _error');}).always(function(a){$('input[name="image_file"]').val('');$('#loading').hide();setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _success _error');},5000);});});$('#pdf_form').trigger('submit');};tinymce.init({selector:'textarea',plugins:['advlist autolink lists link image charmap preview hr','searchreplace wordcount visualblocks visualchars code fullscreen','insertdatetime nonbreaking save table contextmenu directionality','paste textcolor colorpicker textpattern codesample'],codesample_languages:[{text:'HTML/XML',value:'markup'},{text:'JavaScript',value:'javascript'},{text:'CSS',value:'css'},{text:'PHP',value:'php'},{text:'Ruby',value:'ruby'},{text:'Python',value:'python'},{text:'Bash',value:'bash'}],default_link_target:"_blank",language:"ja",toolbar1:"undo redo | bold italic | bullist numlist",toolbar2:"link image forecolor backcolor codesample",link_title:false,link_list:'/api/pdf',image_list:'/api/image',convert_urls:false,file_picker_callback:function(c,d,e){if(e.filetype=='image'){$('#upload').off('change');$('#upload').on('change',function(b){a(b,c);});$('#upload').trigger('click');}if(e.filetype=='file'){$('#pdf_uploader').off('change');$('#pdf_uploader').on('change',function(a){b(a,c);});$('#pdf_uploader').trigger('click');}}});}